# Configuration API

api:
  server:
    host: "0.0.0.0"
    port: 8000
    workers: 4
    timeout: 120
    max_requests: 1000
    max_requests_jitter: 100
    
  cors:
    allowed_origins: ["*"]  # Restreindre en production
    allowed_methods: ["GET", "POST", "OPTIONS"]
    allowed_headers: ["*"]
    
  authentication:
    enabled: true
    method: "bearer"  # bearer, api_key
    api_key_header: "X-API-Key"
    
  rate_limiting:
    enabled: true
    requests_per_minute: 60
    requests_per_hour: 1000
    
  logging:
    level: "INFO"
    format: "json"
    file: "logs/api.log"
    
  database:
    postgresql:
      host: "localhost"
      port: 5432
      database: "farmtrack"
      user: "postgres"
      password: null  # Depuis .env
      
    redis:
      host: "localhost"
      port: 6379
      db: 0
      ttl: 3600  # Cache TTL en secondes

# Configuration backend NestJS pour synchronisation
backend:
  url: "http://localhost:3000"  # URL du backend NestJS - MODIFIER SELON VOTRE CONFIGURATION
  api_key: null  # Clé API optionnelle (depuis .env ou variable d'environnement)
  default_projet_id: null  # ID du projet par défaut (optionnel, peut être fourni dans les requêtes)
  default_user_id: null  # ID de l'utilisateur par défaut (optionnel, peut être fourni dans les requêtes)
  sync_on_startup: true  # Synchroniser les animaux au démarrage
  sync_interval_minutes: 60  # Intervalle de synchronisation automatique (0 = désactivé)
  
  # Configuration pour l'identification automatique
  auto_register_on_first_detection: true  # Enregistrer automatiquement un porc lors de sa première détection
  identification_threshold: 0.7  # Seuil de confiance pour l'identification (0.0 à 1.0)

# Endpoints
endpoints:
  predict:
    path: "/api/predict"
    methods: ["POST"]
    max_file_size_mb: 10
    timeout_seconds: 30
    
  batch_predict:
    path: "/api/batch-predict"
    methods: ["POST"]
    max_file_size_mb: 50
    max_images: 20
    timeout_seconds: 120
    
  health:
    path: "/api/health"
    methods: ["GET"]
    
  models:
    path: "/api/models"
    methods: ["GET"]

